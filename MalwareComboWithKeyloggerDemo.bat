@echo off
setlocal enabledelayedexpansion

:: Configuration
set testFolder=C:\Users\%USERNAME%\Desktop\TestMalware
set logFile=%testFolder%\malware_log.txt
set keylogFile=%testFolder%\keylog.txt
set triggerFile=%testFolder%\trigger.txt
set ransomNote=%testFolder%\README.txt
set scriptName=%~nx0

:: Initialize test environment
call :InitializeTestEnvironment

:: Simulate Trojan facade
call :ShowTrojanFacade

:: Get user input and simulate keylogger
set /p userInput=Enter command (type 'detonate' to trigger manually, or anything else to check triggers):
call :InvokeKeylogger "%userInput%"

:: Check logic bomb triggers
call :TestLogicBombTriggers
if %trigger%==1 (
    echo Logic bomb triggered! Executing malware payloads...
    call :InvokeVirus
    call :InvokeWorm
    call :InvokeRansomware
) else (
    echo Logic bomb not triggered. Malware payloads remain dormant.
)

:: Ask for cleanup
echo Type 'cleanup' to reverse all actions, or press Enter to exit.
set /p cleanupInput=Command:
call :InvokeKeylogger "%cleanupInput%"
if /i "%cleanupInput%"=="cleanup" (
    call :InvokeCleanup
)

exit /b

:InitializeTestEnvironment
if not exist "%testFolder%" (
    mkdir "%testFolder%"
    echo Created test folder: %testFolder%
)
for /l %%i in (1,1,3) do (
    echo This is test file %%i. > "%testFolder%\test%%i.txt"
)
if not exist "%triggerFile%" (
    echo Trigger file > "%triggerFile%"
)
echo Initialized at %DATE% %TIME% >> "%logFile%"
goto :eof

:ShowTrojanFacade
echo System Optimizer v1.0 - Cleaning your system...
timeout /t 1 >nul
echo Scanning files...
timeout /t 1 >nul
echo Removing junk files...
timeout /t 1 >nul
echo Complete!
timeout /t 1 >nul
echo Optimization complete! (Note: This is a Trojan facade hiding malware actions.)
goto :eof

:InvokeKeylogger
echo Keylog at %DATE% %TIME%: %~1 >> "%keylogFile%"
echo Simulated keylogger logged input to %keylogFile%
goto :eof

:TestLogicBombTriggers
set trigger=0
if not exist "%triggerFile%" set trigger=1
if /i "%userInput%"=="detonate" set trigger=1
goto :eof

:InvokeVirus
for %%f in ("%testFolder%\*.txt") do (
    if not "%%~nxf"=="README.txt" if not "%%~nxf"=="malware_log.txt" if not "%%~nxf"=="keylog.txt" (
        echo. >> "%%f"
        echo Infected by demo virus at %DATE% %TIME% >> "%%f"
    )
)
echo Simulated virus infected files
echo Virus activated at %DATE% %TIME% >> "%logFile%"
goto :eof

:InvokeWorm
set copyCount=0
for %%f in ("%testFolder%\copy*.bat") do set /a copyCount+=1
if %copyCount% lss 5 (
    set /a newCopy=%copyCount%+1
    copy "%~f0" "%testFolder%\copy%newCopy%.bat"
    echo Simulated worm created copy: copy%newCopy%.bat
    echo Worm replicated at %DATE% %TIME% >> "%logFile%"
)
goto :eof

:InvokeRansomware
for %%f in ("%testFolder%\*.txt") do (
    if not "%%~nxf"=="README.txt" if not "%%~nxf"=="malware_log.txt" if not "%%~nxf"=="keylog.txt" (
        ren "%%f" "%%~nxf.locked"
    )
)
echo Your files are locked! This is a demo - files can be restored. > "%ransomNote%"
echo Run cleanup to recover. >> "%ransomNote%"
echo Simulated ransomware locked files and created ransom note
echo Ransomware activated at %DATE% %TIME% >> "%logFile%"
goto :eof

:InvokeCleanup
for %%f in ("%testFolder%\*.locked") do (
    ren "%%f" "%%~nf"
)
del "%testFolder%\copy*.bat" 2>nul
del "%ransomNote%" 2>nul
del "%keylogFile%" 2>nul
echo Cleanup complete: Files restored, copies and logs removed
echo Cleanup performed at %DATE% %TIME% >> "%logFile%"
goto :eof